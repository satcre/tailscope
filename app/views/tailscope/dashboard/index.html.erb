<h1 class="text-2xl font-bold mb-6">Dashboard</h1>

<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
  <div class="bg-white rounded-lg shadow p-4">
    <div class="text-sm text-gray-500">Slow Queries</div>
    <div class="text-2xl font-bold text-gray-900"><%= @stats[:queries] %></div>
    <div class="text-xs text-gray-400">avg <%= @stats[:avg_query_ms] %>ms</div>
  </div>
  <div class="bg-white rounded-lg shadow p-4">
    <div class="text-sm text-gray-500">N+1 Queries</div>
    <div class="text-2xl font-bold text-red-600"><%= @stats[:n_plus_one] %></div>
  </div>
  <div class="bg-white rounded-lg shadow p-4">
    <div class="text-sm text-gray-500">Slow Requests</div>
    <div class="text-2xl font-bold text-gray-900"><%= @stats[:requests] %></div>
    <div class="text-xs text-gray-400">avg <%= @stats[:avg_request_ms] %>ms</div>
  </div>
  <div class="bg-white rounded-lg shadow p-4">
    <div class="text-sm text-gray-500">Errors</div>
    <div class="text-2xl font-bold text-red-600"><%= @stats[:errors] %></div>
  </div>
</div>

<h2 class="text-lg font-semibold mb-3">Recent Events</h2>
<div class="bg-white rounded-lg shadow overflow-hidden">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Summary</th>
        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Duration</th>
        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">When</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-100">
      <% @recent_events.each do |event| %>
        <tr class="hover:bg-gray-50">
          <td class="px-4 py-2">
            <% type = event["type"] %>
            <span class="inline-block px-2 py-0.5 text-xs rounded font-medium
              <%= type == 'error' ? 'bg-red-100 text-red-700' : type == 'query' ? 'bg-blue-100 text-blue-700' : 'bg-green-100 text-green-700' %>">
              <%= type %>
            </span>
          </td>
          <td class="px-4 py-2 text-sm font-mono text-gray-700 max-w-md truncate">
            <% path = type == "query" ? tailscope.query_path(event["id"]) : type == "request" ? tailscope.request_path(event["id"]) : tailscope.error_path(event["id"]) %>
            <a href="<%= path %>" class="hover:text-blue-600"><%= truncate_sql(event["summary"]) %></a>
          </td>
          <td class="px-4 py-2"><%= duration_badge(event["duration_ms"]) %></td>
          <td class="px-4 py-2 text-xs text-gray-500"><%= time_ago_in_words_short(event["recorded_at"]) %></td>
        </tr>
      <% end %>
      <% if @recent_events.empty? %>
        <tr><td colspan="4" class="px-4 py-8 text-center text-gray-400">No events recorded yet.</td></tr>
      <% end %>
    </tbody>
  </table>
</div>
